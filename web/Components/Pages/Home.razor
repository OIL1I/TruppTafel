@page "/"
@rendermode InteractiveServer
@using web.Components.Modules
@using web.Lib.Logic

<PageTitle>TruppTafel</PageTitle>

@if (isLoaded)
{
    <div class="d-flex flex-column fahrzeug-halter">
        <div class="d-flex flex-row justify-content-center">
            @foreach (var fahrzeug in fahrzeuge)
            {
                <FahrzeugTabelle @key="fahrzeug.Id" fahrzeug="fahrzeug"/>
            }
        </div>
        <div class="flex-column justify-content-center">
            <div class="d-flex justify-content-center m-4">
                <p class="m-2">Sortieren:</p>
                <select class="form-select w-auto" @bind="aktuelleOrdnung" @onchange="OnSortSelectionChanged">
                    <option value="@SortierOrdnung.Alphabet">Alphabet</option>
                    <option value="@SortierOrdnung.Ausbildung">Ausbildung</option>
                </select>
            </div>
            <div class="d-flex flex-wrap justify-content-center">
                @foreach (var person in personen)
                {
                    <PersonenTafel @key="person.Id" person="person"/>
                }
            </div>
        </div>
    </div>
}


@code {

    private enum SortierOrdnung
    {
        Alphabet,
        Ausbildung
    }
    
    private List<Person> personen = new();
    private List<Fahrzeug> fahrzeuge = new();
    private bool isLoaded = false;
    private SortierOrdnung aktuelleOrdnung = SortierOrdnung.Alphabet;
    private Person besucher = new Person("Besucher", Ausbildungsgrad.TM1_2);

    protected override void OnInitialized()
    {
        LoadData();
    }

    protected override void OnParametersSet()
    {
        LoadData();
    }

    private void LoadData()
    {
        personen = Global.AppData.Personen.ToList();
        fahrzeuge = Global.AppData.Fahrzeuge.ToList();
        //Besucher immer am Ender hinzufügen
        personen.Add(besucher);
        isLoaded = true;
    }

    private void OnSortSelectionChanged(ChangeEventArgs e)
    {
        switch(aktuelleOrdnung)
        {
            case SortierOrdnung.Alphabet:
                //TODO: Sortieren nach Alphabet
                break;
            case SortierOrdnung.Ausbildung:
                //TODO: Sortieren nach Ausbildung
                break;
        }
    }
}